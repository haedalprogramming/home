#!/bin/bash

# =====================================================
# í•´ë‹¬í”„ë¡œê·¸ëž˜ë° í™ˆíŽ˜ì´ì§€ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
# =====================================================
# 
# ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” í™˜ê²½ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ê³  config.jsë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
# ì£¼ë¡œ CI/CD íŒŒì´í”„ë¼ì¸ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.
#
# ì‚¬ìš©ë²•: ./deploy.sh
# ê¶Œí•œ ì„¤ì •: chmod +x deploy.sh
#
# @author í•´ë‹¬í”„ë¡œê·¸ëž˜ë°
# @version 1.0.0

echo "ðŸš€ í•´ë‹¬í”„ë¡œê·¸ëž˜ë° í™ˆíŽ˜ì´ì§€ ë°°í¬ ì‹œìž‘..."

# í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜ í™•ì¸
# ===================

echo "ðŸ” í™˜ê²½ë³€ìˆ˜ í™•ì¸ ì¤‘..."

# reCAPTCHA ì‚¬ì´íŠ¸ í‚¤ í™•ì¸
if [ -z "$RECAPTCHA_SITE_KEY" ]; then
    echo "âŒ RECAPTCHA_SITE_KEY í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
    echo "   Google reCAPTCHA ì½˜ì†”ì—ì„œ ì‚¬ì´íŠ¸ í‚¤ë¥¼ ë°œê¸‰ë°›ì•„ ì„¤ì •í•´ì£¼ì„¸ìš”."
    exit 1
fi

# Zapier ì›¹í›… URL í™•ì¸
if [ -z "$ZAPIER_WEBHOOK_URL" ]; then
    echo "âŒ ZAPIER_WEBHOOK_URL í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
    echo "   Zapierì—ì„œ ì›¹í›… URLì„ ìƒì„±í•˜ì—¬ ì„¤ì •í•´ì£¼ì„¸ìš”."
    exit 1
fi

echo "âœ… ëª¨ë“  í™˜ê²½ë³€ìˆ˜ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤."

# config.js íŒŒì¼ ìƒì„±
# ===================

echo "ðŸ“ config.js íŒŒì¼ ìƒì„± ì¤‘..."

# í˜„ìž¬ ì‹œê° ê¸°ë¡
CURRENT_TIME=$(date '+%Y-%m-%d %H:%M:%S')

# config.js íŒŒì¼ ë‚´ìš© ìƒì„± (Heredoc ì‚¬ìš©)
cat > config.js << EOF
/**
 * í™˜ê²½ë³€ìˆ˜ ì„¤ì • íŒŒì¼ (ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¡œ ìƒì„±ë¨)
 * ===============================================
 * 
 * âš ï¸  ì´ íŒŒì¼ì€ deploy.shì— ì˜í•´ ìžë™ ìƒì„±ë©ë‹ˆë‹¤.
 * âš ï¸  ì§ì ‘ ìˆ˜ì •í•˜ì§€ ë§ˆì„¸ìš”. ë°°í¬ ì‹œ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.
 * 
 * ìƒì„± ì‹œê°: ${CURRENT_TIME}
 */

// í™˜ê²½ë³€ìˆ˜ì—ì„œ ì£¼ìž…ëœ ì„¤ì •ê°’ (ë°°í¬ ì‹œì ì— ìƒì„±ë¨)
window.ENV = {
    RECAPTCHA_SITE_KEY: '${RECAPTCHA_SITE_KEY}',
    ZAPIER_WEBHOOK_URL: '${ZAPIER_WEBHOOK_URL}'
};
EOF

# ë°°í¬ ì™„ë£Œ ë©”ì‹œì§€
echo "âœ… í™˜ê²½ë³€ìˆ˜ê°€ config.jsì— ì„±ê³µì ìœ¼ë¡œ ì£¼ìž…ë˜ì—ˆìŠµë‹ˆë‹¤."
echo "ðŸ“ RECAPTCHA_SITE_KEY: ${RECAPTCHA_SITE_KEY:0:10}..."  # ë³´ì•ˆì„ ìœ„í•´ ì²˜ìŒ 10ìžë§Œ í‘œì‹œ
echo "ðŸ“ ZAPIER_WEBHOOK_URL: ${ZAPIER_WEBHOOK_URL}"
echo "ðŸŽ‰ ë°°í¬ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
